<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Inventario</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì¶</text></svg>">
    <link rel="stylesheet" href="../../shared/css/variables.css">
    <link rel="stylesheet" href="../../shared/css/base.css">
    <link rel="stylesheet" href="../../shared/css/layout.css">
    <link rel="stylesheet" href="../../shared/css/components.css">
    <link rel="stylesheet" href="../../shared/css/sidebar.css">
    <link rel="stylesheet" href="../../shared/css/inventory.css">
    <link rel="stylesheet" href="../../shared/css/avatar-system.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="../../shared/js/wms-utils.js"></script>
    
    <!-- Advanced Sync System -->
    <script src="../../shared/js/sync-utils.js?v=3.0.3"></script>
    <script src="../../shared/js/processed-cache-manager.js?v=3.0.3"></script>
    <script src="../../shared/js/advanced-sync-manager.js?v=3.0.3"></script>
    
    <!-- IMPORTANTE: avatar-system.js DEBE cargarse ANTES de sidebar-component.js -->
    <script src="../../shared/js/avatar-system.js"></script>
    <script src="../../shared/js/sidebar-component.js"></script>
    
    <!-- Sync Configuration -->
    <script src="sync-config.js?v=3.0.3"></script>
</head>
<body>
    <div class="connection-banner" id="connection-banner"></div>
    <div class="notification-container" id="notifications"></div>

    <div class="preloader-overlay" id="loading-overlay">
        <div class="preloader-content">
            <div class="preloader-spinner"></div>
            <div class="preloader-text" style="color: #333;">üì¶ Cargando Inventario...</div>
            <div class="preloader-subtext" style="color: #666;">Descargando base de datos desde Google Sheets</div>
        </div>
    </div>

    <div class="login-screen" id="login-screen">
        <div class="login-card">
            <div class="login-icon">üì¶</div>
            <h1 class="login-title">Sistema Inventario</h1>
            <p class="login-subtitle">Control y gesti√≥n de mercanc√≠a</p>
            <button class="btn btn-google" onclick="handleLogin()" style="padding: 15px; font-size: 1.1em; width: 100%;">
                üîê Iniciar sesi√≥n con Google
            </button>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <div class="main-container">
            <!-- SIDEBAR -->
            <div class="sidebar" id="sidebar"></div>

            <div class="main-content">
                <!-- Tab Bar -->
                <div class="tabs-header" id="tabs-header" style="display: none;">
                    <div class="tab-bar" id="tab-bar"></div>
                    <button class="tab-add-btn" id="tab-add-btn" onclick="GlobalTabs.createTab()" title="Nueva pesta√±a">
                        <span>+</span>
                    </button>
                    <div class="tabs-actions">
                        <button class="btn btn-secondary btn-small" onclick="exportData()">üì• CSV</button>
                    </div>
                </div>

                <!-- Welcome State -->
                <div class="welcome-state module-visible" id="welcome-state">
                    <div class="welcome-content">
                        <div class="welcome-icon">üì¶</div>
                        <h2 class="welcome-title">Sistema de Inventario</h2>
                        <p class="welcome-subtitle">Comienza agregando una nueva sesi√≥n de trabajo</p>
                        <button class="btn btn-success btn-start" onclick="GlobalTabs.createTab()">
                            üöÄ Nuevo
                        </button>
                    </div>
                </div>

                <!-- Classic Module -->
                <div class="classic-module module-hidden" id="classic-module">
                    <div class="scan-header-bar">
                        <div class="origin-location-group">
                            <label>üìç Origen:</label>
                            <input type="text" class="origin-location-input" id="origin-location"
                                   placeholder="A21-06-05-01" autocomplete="off">
                        </div>
                        <div class="global-counter">
                            <span class="global-counter-label">Total Cajas:</span>
                            <span class="global-counter-value" id="global-box-count">0</span>
                        </div>
                    </div>

                    <div class="scan-section">
                        <div class="scan-row">
                            <div class="scan-input-group" style="flex: 2;">
                                <input type="text" class="scan-input" id="scan-input"
                                       placeholder="üîç Escanea o ingresa c√≥digo..." autocomplete="off">
                            </div>
                            <div class="scan-input-group code2-inline" id="code2-inline" style="flex: 1; display: none;">
                                <input type="text" class="scan-input" id="code2-input"
                                       placeholder="C√≥digo 2..." autocomplete="off" style="background: #fff5ed;">
                            </div>
                            <button class="btn btn-warning btn-insertar" id="btn-insertar" onclick="forceInsert()" style="display: none;">
                                ‚ö° Insertar
                            </button>
                        </div>

                        <div class="result-box" id="result-box">
                            <div class="result-compact">
                                <div class="result-status">
                                    <span class="icon" id="result-icon">üì¶</span>
                                    <span id="result-title">Estado</span>
                                </div>
                                <div class="result-info">
                                    <span id="result-details"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="columns-container">
                        <div class="column ok">
                            <div class="column-header">
                                <span class="column-title">‚úÖ OK</span>
                                <div class="column-header-right">
                                    <div class="verification-badges" id="ok-verification-badges">
                                        <span class="v-badge ok" id="ok-verified-badge">‚úì <span id="ok-verified-count">0</span></span>
                                        <span class="v-badge pending" id="ok-pending-badge">‚óã <span id="ok-pending-count">0</span></span>
                                    </div>
                                    <span class="column-count" id="ok-count">0</span>
                                    <button class="expand-btn" onclick="showPalletDetailModal('ok')" title="Ver detalles">
                                        <svg viewBox="0 0 24 24"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="column-pallet-info">
                                <div>Pallet: <span class="column-pallet-code" id="ok-pallet">-</span></div>
                                <input type="text" class="column-location-input" id="location-ok"
                                       placeholder="üìç Ubicaci√≥n destino...">
                                <button class="column-send-btn" onclick="sendPallet('ok')" id="send-ok-btn" disabled>
                                    üì§ Enviar Tarima OK
                                </button>
                            </div>
                            <div class="column-list" id="ok-list">
                                <div class="empty-state">
                                    <div class="empty-icon">üì≠</div>
                                    <div>Sin cajas</div>
                                </div>
                            </div>
                        </div>

                        <div class="column blocked">
                            <div class="column-header">
                                <span class="column-title">‚ö†Ô∏è Bloqueado</span>
                                <div class="column-header-right">
                                    <span class="column-count" id="blocked-count">0</span>
                                    <button class="expand-btn" onclick="showPalletDetailModal('blocked')" title="Ver detalles">
                                        <svg viewBox="0 0 24 24"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="column-pallet-info">
                                <div>Pallet: <span class="column-pallet-code" id="blocked-pallet">-</span></div>
                                <input type="text" class="column-location-input" id="location-blocked"
                                       placeholder="üìç Ubicaci√≥n destino...">
                                <button class="column-send-btn" onclick="sendPallet('blocked')" id="send-blocked-btn" disabled>
                                    üì§ Enviar Tarima Bloqueado
                                </button>
                            </div>
                            <div class="column-list" id="blocked-list">
                                <div class="empty-state">
                                    <div class="empty-icon">üì≠</div>
                                    <div>Sin cajas</div>
                                </div>
                            </div>
                        </div>

                        <div class="column nowms">
                            <div class="column-header">
                                <span class="column-title">‚ùå No WMS</span>
                                <div class="column-header-right">
                                    <span class="column-count" id="nowms-count">0</span>
                                    <button class="expand-btn" onclick="showPalletDetailModal('nowms')" title="Ver detalles">
                                        <svg viewBox="0 0 24 24"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="column-pallet-info">
                                <div>Pallet: <span class="column-pallet-code" id="nowms-pallet">-</span></div>
                                <input type="text" class="column-location-input" id="location-nowms"
                                       placeholder="üìç Ubicaci√≥n destino...">
                                <button class="column-send-btn" onclick="sendPallet('nowms')" id="send-nowms-btn" disabled>
                                    üì§ Enviar Tarima No WMS
                                </button>
                            </div>
                            <div class="column-list" id="nowms-list">
                                <div class="empty-state">
                                    <div class="empty-icon">üì≠</div>
                                    <div>Sin cajas</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Unified Module -->
                <div class="unified-module module-hidden" id="unified-module">
                    <div class="scan-header-bar">
                        <div class="origin-location-group">
                            <label>üìç Origen:</label>
                            <input type="text" class="origin-location-input" id="unified-origin-location"
                                   placeholder="A21-06-05-01" autocomplete="off">
                        </div>
                        <div class="origin-location-group">
                            <label>üìç Destino:</label>
                            <input type="text" class="origin-location-input" id="unified-dest-location"
                                   placeholder="B15-03-02-01" autocomplete="off">
                        </div>
                        <div class="global-counter">
                            <span class="global-counter-label">Total:</span>
                            <span class="global-counter-value" id="unified-box-count">0</span>
                        </div>
                    </div>

                    <div class="scan-section">
                        <div class="scan-row">
                            <div class="scan-input-group" style="flex: 2;">
                                <input type="text" class="scan-input" id="unified-scan-input"
                                       placeholder="üîç Escanea o ingresa c√≥digo..." autocomplete="off">
                            </div>
                            <div class="scan-input-group code2-inline" id="unified-code2-inline" style="flex: 1; display: none;">
                                <input type="text" class="scan-input" id="unified-code2-input"
                                       placeholder="C√≥digo 2..." autocomplete="off" style="background: #fff5ed;">
                            </div>
                        </div>

                        <div class="result-box" id="unified-result-box">
                            <div class="result-compact">
                                <div class="result-status">
                                    <span class="icon" id="unified-result-icon">üì¶</span>
                                    <span id="unified-result-title">Listo para escanear</span>
                                </div>
                                <div class="result-info">
                                    <span id="unified-result-details"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="unified-list-container">
                        <div class="unified-list-header">
                            <span class="unified-list-title">üìã Registros</span>
                            <div class="unified-list-actions">
                                <label class="cancelados-toggle" id="cancelados-toggle-label" title="Modo Cancelados">
                                    <input type="checkbox" id="unified-cancelados-check" onchange="UnifiedModule.toggleCancelados(this.checked)">
                                    <span class="cancelados-slider"></span>
                                    <span class="cancelados-text">üö´</span>
                                </label>
                                <button class="btn btn-small btn-secondary" onclick="UnifiedModule.clearList()">
                                    üóëÔ∏è Limpiar
                                </button>
                                <button class="btn btn-small btn-primary" onclick="UnifiedModule.sendAll()" id="unified-send-btn" disabled>
                                    üì§ Enviar Todo
                                </button>
                            </div>
                        </div>
                        <div class="unified-list" id="unified-list">
                            <div class="empty-state">
                                <div class="empty-icon">üì≠</div>
                                <div>Sin registros</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
