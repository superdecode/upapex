<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì¶ Sistema Inventario</title>
    <link rel="stylesheet" href="../../shared/css/variables.css">
    <link rel="stylesheet" href="../../shared/css/base.css">
    <link rel="stylesheet" href="../../shared/css/layout.css">
    <link rel="stylesheet" href="../../shared/css/components.css">
    <link rel="stylesheet" href="../../shared/css/inventory.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="../../shared/js/wms-utils.js"></script>
    <script src="../../shared/js/sync-manager.js"></script>
</head>
<body>
    <div class="connection-banner" id="connection-banner"></div>
    <div class="notification-container" id="notifications"></div>

    <div class="preloader-overlay" id="loading-overlay">
        <div class="preloader-content">
            <div class="preloader-spinner"></div>
            <div class="preloader-text">üì¶ Cargando Inventario...</div>
            <div class="preloader-subtext">Descargando base de datos desde Google Sheets</div>
        </div>
    </div>

    <div class="login-screen" id="login-screen">
        <div class="login-card">
            <div class="login-icon">üì¶</div>
            <h1 class="login-title">Sistema Inventario</h1>
            <p class="login-subtitle">Control y gesti√≥n de mercanc√≠a</p>
            <button class="btn btn-google" onclick="handleLogin()" style="padding: 15px; font-size: 1.1em; width: 100%;">
                üîê Iniciar sesi√≥n con Google
            </button>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <div class="main-container">
            <div class="sidebar">
                <div class="sidebar-header">
                    <h2>üì¶ Inventario</h2>
                    <p>Sistema de gesti√≥n</p>
                </div>

                <div id="sync-status" class="sync-status sync-ok">
                    ‚úÖ Sincronizado
                </div>

                <div class="sidebar-section">
                    <button class="sidebar-btn sidebar-btn-primary" onclick="showResumen()">
                        üìä Resumen
                    </button>
                    <button class="sidebar-btn sidebar-btn-secondary" onclick="startNewSession()">
                        ‚ûï Nueva Sesi√≥n
                    </button>
                    <button class="sidebar-btn sidebar-btn-secondary" onclick="window.syncManager?.showPanel()">
                        üîÑ Sincronizaci√≥n
                    </button>
                    <button class="sidebar-btn sidebar-btn-secondary" onclick="exportData()">
                        üì• Exportar
                    </button>
                </div>

                <div class="user-footer">
                    <div class="user-info">
                        <div class="user-avatar" id="user-avatar">?</div>
                        <div class="user-details">
                            <div class="user-name" id="user-name-display">No conectado</div>
                            <div class="connection-indicator">
                                <div class="connection-dot" id="connection-dot"></div>
                                <span id="connection-text">Offline</span>
                            </div>
                        </div>
                    </div>
                    <div class="user-footer-actions" style="display: flex; gap: 5px; margin-bottom: 8px;">
                        <button class="btn btn-secondary btn-small" onclick="refreshInventory()">üîÑ BD</button>
                        <button class="btn btn-danger btn-small" onclick="handleLogout()">üö™</button>
                    </div>
                    <div class="bd-info" style="font-size: 0.7em; color: #aaa; text-align: center; line-height: 1.4;">
                        <div><span id="bd-count">0</span> c√≥digos cargados</div>
                        <div id="bd-update-time">Sin actualizar</div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="scan-header-bar">
                    <div class="origin-location-group">
                        <label>üìç Origen:</label>
                        <input type="text" class="origin-location-input" id="origin-location"
                               placeholder="A21-06-05-01" autocomplete="off">
                    </div>
                    <div class="global-counter">
                        <span class="global-counter-label">Total Cajas:</span>
                        <span class="global-counter-value" id="global-box-count">0</span>
                    </div>
                </div>

                <div class="scan-section">
                    <input type="text" class="scan-input" id="scan-input" 
                           placeholder="üîç Escanea o ingresa c√≥digo..." autocomplete="off">
                    
                    <div class="result-box" id="result-box">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span id="result-icon">üì¶</span>
                            <span id="result-title">Estado</span>
                            <span id="result-details" style="color: #666; font-size: 0.85em;"></span>
                        </div>
                    </div>
                    
                    <!-- Code2 Container (hidden by default) -->
                    <div id="code2-container" style="display: none; margin-top: 10px; padding: 10px; background: #fff3e0; border-radius: 6px; border: 2px solid var(--warning);">
                        <div style="font-size: 0.9em; margin-bottom: 8px; font-weight: 600; color: #666;">
                            ‚ö†Ô∏è C√≥digo no encontrado - Ingresa C√≥digo 2 alternativo:
                        </div>
                        <input type="text" class="scan-input" id="code2-input" 
                               placeholder="üîç C√≥digo 2..." autocomplete="off" style="background: white;">
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                            <button class="btn btn-warning btn-small" onclick="forceInsert()" style="flex: 1;">
                                ‚ö° INSERTADO (Sin Code2)
                            </button>
                        </div>
                    </div>
                </div>

                <div class="columns-container">
                    <div class="column ok">
                        <div class="column-header">
                            <span class="column-title">‚úÖ OK</span>
                            <span class="column-count" id="ok-count">0</span>
                        </div>
                        <div class="column-pallet-info">
                            <div>Pallet: <span class="column-pallet-code" id="ok-pallet">-</span></div>
                            <input type="text" class="column-location-input" id="location-ok" 
                                   placeholder="üìç Ubicaci√≥n destino...">
                            <div style="display: flex; gap: 5px; margin-bottom: 5px;">
                                <button class="btn btn-small btn-secondary" onclick="toggleBlindCount('ok')" title="Activar/Desactivar validaci√≥n ciega" style="flex: 1;">
                                    üîí Ciega
                                </button>
                            </div>
                            <button class="column-send-btn" onclick="sendPallet('ok')" id="send-ok-btn" disabled>
                                üì§ Enviar Tarima OK
                            </button>
                        </div>
                        <div class="column-list" id="ok-list">
                            <div class="empty-state">
                                <div class="empty-icon">üì≠</div>
                                <div>Sin cajas</div>
                            </div>
                        </div>
                    </div>

                    <div class="column blocked">
                        <div class="column-header">
                            <span class="column-title">‚ö†Ô∏è Bloqueado</span>
                            <span class="column-count" id="blocked-count">0</span>
                        </div>
                        <div class="column-pallet-info">
                            <div>Pallet: <span class="column-pallet-code" id="blocked-pallet">-</span></div>
                            <input type="text" class="column-location-input" id="location-blocked" 
                                   placeholder="üìç Ubicaci√≥n destino...">
                            <div style="display: flex; gap: 5px; margin-bottom: 5px;">
                                <button class="btn btn-small btn-secondary" onclick="toggleBlindCount('blocked')" title="Activar/Desactivar validaci√≥n ciega" style="flex: 1;">
                                    üîí Ciega
                                </button>
                            </div>
                            <button class="column-send-btn" onclick="sendPallet('blocked')" id="send-blocked-btn" disabled>
                                üì§ Enviar Tarima Bloqueado
                            </button>
                        </div>
                        <div class="column-list" id="blocked-list">
                            <div class="empty-state">
                                <div class="empty-icon">üì≠</div>
                                <div>Sin cajas</div>
                            </div>
                        </div>
                    </div>

                    <div class="column nowms">
                        <div class="column-header">
                            <span class="column-title">‚ùå No WMS</span>
                            <span class="column-count" id="nowms-count">0</span>
                        </div>
                        <div class="column-pallet-info">
                            <div>Pallet: <span class="column-pallet-code" id="nowms-pallet">-</span></div>
                            <input type="text" class="column-location-input" id="location-nowms" 
                                   placeholder="üìç Ubicaci√≥n destino...">
                            <div style="display: flex; gap: 5px; margin-bottom: 5px;">
                                <button class="btn btn-small btn-secondary" onclick="toggleBlindCount('nowms')" title="Activar/Desactivar validaci√≥n ciega" style="flex: 1;">
                                    üîí Ciega
                                </button>
                            </div>
                            <button class="column-send-btn" onclick="sendPallet('nowms')" id="send-nowms-btn" disabled>
                                üì§ Enviar Tarima No WMS
                            </button>
                        </div>
                        <div class="column-list" id="nowms-list">
                            <div class="empty-state">
                                <div class="empty-icon">üì≠</div>
                                <div>Sin cajas</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
